<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purchase Parts Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: #333;
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            margin-bottom: 25px;
        }
        
        .pdf-upload-section {
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        .github-url-input {
            display: flex;
            max-width: 700px;
            margin: 0 auto 20px;
        }
        
        .github-url-input input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }
        
        .github-url-input button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        .github-url-input button:hover {
            background-color: #2980b9;
        }
        
        .demo-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            margin-top: 10px;
            transition: background-color 0.3s;
        }
        
        .demo-btn:hover {
            background-color: #27ae60;
        }
        
        .search-section {
            background-color: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .search-box {
            display: flex;
            max-width: 600px;
        }
        
        .search-box input {
            flex: 1;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }
        
        .search-box button {
            background-color: #9b59b6;
            color: white;
            border: none;
            padding: 0 25px;
            border-radius: 0 8px 8px 0;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
        }
        
        .content-area {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .companies-section {
            flex: 1;
            min-width: 300px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .parts-section {
            flex: 2;
            min-width: 600px;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .company-list {
            list-style: none;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .company-item {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #3498db;
            background-color: #f9f9f9;
        }
        
        .company-item:hover {
            background-color: #e8f4fc;
        }
        
        .company-item.active {
            background-color: #d6eaf8;
            border-left-color: #2c3e50;
        }
        
        .company-name {
            font-weight: 600;
            font-size: 18px;
            color: #2c3e50;
        }
        
        .purchase-count {
            background-color: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .parts-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .parts-table th {
            text-align: left;
            padding: 15px;
            background-color: #f2f6fa;
            color: #2c3e50;
            font-weight: 600;
            border-bottom: 2px solid #ddd;
        }
        
        .parts-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .parts-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .price-cell {
            font-weight: 600;
            color: #27ae60;
        }
        
        .different-price {
            color: #e74c3c;
        }
        
        .no-parts {
            text-align: center;
            color: #7f8c8d;
            padding: 40px;
            font-style: italic;
        }
        
        .statistics {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .stat-box {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background-color: #f8f9fa;
            flex: 1;
            margin: 0 10px;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .highlight {
            background-color: #fffacd;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #7f8c8d;
            font-size: 14px;
        }
        
        @media (max-width: 1100px) {
            .content-area {
                flex-direction: column;
            }
            
            .companies-section, .parts-section {
                min-width: 100%;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tools"></i> Purchase Parts Management System</h1>
            <p class="subtitle">Extract and analyze purchase data from PDF invoices with company-wise categorization</p>
        </header>
        
        <section class="pdf-upload-section">
            <h2>Read PDF from GitHub</h2>
            <p>Enter the GitHub URL of your PDF invoice file or use demo data</p>
            
            <div class="github-url-input">
                <input type="text" id="githubUrl" placeholder="https://github.com/username/repo/blob/main/invoices.pdf">
                <button id="loadPdfBtn">
                    <i class="fas fa-file-import"></i> Load PDF
                </button>
            </div>
            
            <button class="demo-btn" id="loadDemoBtn">
                <i class="fas fa-vial"></i> Load Demo Data
            </button>
        </section>
        
        <section class="search-section">
            <h2>Search Spare Parts Directly</h2>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Enter spare part name (e.g., bearing, motor, valve)">
                <button id="searchBtn">
                    <i class="fas fa-search"></i> Search
                </button>
            </div>
        </section>
        
        <div class="content-area">
            <section class="companies-section">
                <h3 class="section-title">
                    <span>Supplier Companies</span>
                    <span id="companyCount">0</span>
                </h3>
                <ul class="company-list" id="companyList">
                    <!-- Companies will be loaded here -->
                </ul>
                
                <div class="statistics">
                    <div class="stat-box">
                        <div class="stat-value" id="totalPurchases">0</div>
                        <div class="stat-label">Total Purchases</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="totalSpent">$0</div>
                        <div class="stat-label">Total Amount</div>
                    </div>
                </div>
            </section>
            
            <section class="parts-section">
                <h3 class="section-title">
                    <span id="selectedCompany">Select a Company</span>
                </h3>
                
                <div id="partsContainer">
                    <table class="parts-table" id="partsTable">
                        <thead>
                            <tr>
                                <th>Part Name</th>
                                <th>Invoice #</th>
                                <th>Price</th>
                                <th>Date</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="partsTableBody">
                            <!-- Parts will be loaded here -->
                        </tbody>
                    </table>
                    <div id="noPartsMessage" class="no-parts">
                        <p>No parts data available. Please select a company or load PDF data.</p>
                    </div>
                </div>
                
                <div class="statistics">
                    <div class="stat-box">
                        <div class="stat-value" id="totalParts">0</div>
                        <div class="stat-label">Parts in Selection</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="avgPrice">$0</div>
                        <div class="stat-label">Average Price</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="dateRange">-</div>
                        <div class="stat-label">Date Range</div>
                    </div>
                </div>
            </section>
        </div>
        
        <div class="footer">
            <p>Purchase Parts Management System &copy; 2023 | Automatically extracts purchase data from PDF invoices</p>
        </div>
    </div>

    <script>
        // Sample data - In a real implementation, this would be extracted from PDF
        const demoPurchaseData = {
            companies: [
                {
                    id: 1,
                    name: "Precision Machinery Inc.",
                    purchaseCount: 8,
                    totalSpent: 24550.75
                },
                {
                    id: 2,
                    name: "Global Industrial Supplies",
                    purchaseCount: 12,
                    totalSpent: 18720.30
                },
                {
                    id: 3,
                    name: "Advanced Auto Parts Ltd.",
                    purchaseCount: 5,
                    totalSpent: 8920.50
                },
                {
                    id: 4,
                    name: "Tech Components Corp.",
                    purchaseCount: 6,
                    totalSpent: 15340.20
                },
                {
                    id: 5,
                    name: "Reliable Hardware Co.",
                    purchaseCount: 3,
                    totalSpent: 5420.00
                }
            ],
            parts: [
                {
                    id: 1,
                    companyId: 1,
                    partName: "Axial Bearing",
                    invoiceNumber: "INV-2023-001",
                    price: 245.75,
                    date: "2023-01-15",
                    note: "High precision bearing"
                },
                {
                    id: 2,
                    companyId: 1,
                    partName: "Hydraulic Pump",
                    invoiceNumber: "INV-2023-012",
                    price: 1250.00,
                    date: "2023-02-10",
                    note: "Heavy duty model"
                },
                {
                    id: 3,
                    companyId: 1,
                    partName: "Axial Bearing",
                    invoiceNumber: "INV-2023-025",
                    price: 275.50,
                    date: "2023-03-22",
                    note: "Different supplier batch"
                },
                {
                    id: 4,
                    companyId: 2,
                    partName: "Steel Valve",
                    invoiceNumber: "INV-2023-005",
                    price: 85.30,
                    date: "2023-01-20",
                    note: "Standard pressure valve"
                },
                {
                    id: 5,
                    companyId: 2,
                    partName: "Electric Motor",
                    invoiceNumber: "INV-2023-008",
                    price: 450.00,
                    date: "2023-01-28",
                    note: "5 HP motor"
                },
                {
                    id: 6,
                    companyId: 2,
                    partName: "Control Panel",
                    invoiceNumber: "INV-2023-015",
                    price: 1200.00,
                    date: "2023-02-14",
                    note: "With touchscreen"
                },
                {
                    id: 7,
                    companyId: 3,
                    partName: "Brake Disc",
                    invoiceNumber: "INV-2023-009",
                    price: 65.50,
                    date: "2023-02-05",
                    note: "Vented brake disc"
                },
                {
                    id: 8,
                    companyId: 3,
                    partName: "Oil Filter",
                    invoiceNumber: "INV-2023-011",
                    price: 12.75,
                    date: "2023-02-08",
                    note: "Synthetic media"
                },
                {
                    id: 9,
                    companyId: 4,
                    partName: "Circuit Board",
                    invoiceNumber: "INV-2023-017",
                    price: 320.40,
                    date: "2023-03-01",
                    note: "Main control board"
                },
                {
                    id: 10,
                    companyId: 4,
                    partName: "Temperature Sensor",
                    invoiceNumber: "INV-2023-022",
                    price: 45.80,
                    date: "2023-03-15",
                    note: "Digital sensor"
                },
                {
                    id: 11,
                    companyId: 5,
                    partName: "Steel Valve",
                    invoiceNumber: "INV-2023-028",
                    price: 92.00,
                    date: "2023-04-05",
                    note: "High-pressure variant"
                },
                {
                    id: 12,
                    companyId: 1,
                    partName: "Gear Assembly",
                    invoiceNumber: "INV-2023-030",
                    price: 875.25,
                    date: "2023-04-10",
                    note: "Custom gear ratio"
                }
            ]
        };

        // State variables
        let currentData = null;
        let selectedCompanyId = null;
        let searchTerm = "";
        
        // DOM elements
        const companyListEl = document.getElementById('companyList');
        const partsTableBodyEl = document.getElementById('partsTableBody');
        const noPartsMessageEl = document.getElementById('noPartsMessage');
        const partsTableEl = document.getElementById('partsTable');
        const companyCountEl = document.getElementById('companyCount');
        const selectedCompanyEl = document.getElementById('selectedCompany');
        const totalPurchasesEl = document.getElementById('totalPurchases');
        const totalSpentEl = document.getElementById('totalSpent');
        const totalPartsEl = document.getElementById('totalParts');
        const avgPriceEl = document.getElementById('avgPrice');
        const dateRangeEl = document.getElementById('dateRange');
        const searchInputEl = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const loadPdfBtn = document.getElementById('loadPdfBtn');
        const loadDemoBtn = document.getElementById('loadDemoBtn');
        const githubUrlEl = document.getElementById('githubUrl');
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            searchBtn.addEventListener('click', performSearch);
            searchInputEl.addEventListener('keyup', function(event) {
                if (event.key === 'Enter') {
                    performSearch();
                }
            });
            
            loadDemoBtn.addEventListener('click', loadDemoData);
            loadPdfBtn.addEventListener('click', loadFromGithub);
            
            // Display initial state
            updateDisplay();
        });
        
        // Load demo data
        function loadDemoData() {
            currentData = JSON.parse(JSON.stringify(demoPurchaseData)); // Deep copy
            updateDisplay();
            showNotification("Demo data loaded successfully!");
            
            // Auto-select first company
            if (currentData.companies.length > 0) {
                selectCompany(currentData.companies[0].id);
            }
        }
        
        // Simulate loading from GitHub (in a real app, this would fetch and parse PDF)
        function loadFromGithub() {
            const url = githubUrlEl.value.trim();
            
            if (!url) {
                showNotification("Please enter a GitHub URL", "error");
                return;
            }
            
            // Show loading state
            loadPdfBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
            loadPdfBtn.disabled = true;
            
            // Simulate API call delay
            setTimeout(() => {
                // In a real implementation, you would:
                // 1. Fetch the PDF from GitHub
                // 2. Parse the PDF to extract text/data
                // 3. Process the text to find company names, parts, prices, etc.
                // 4. Structure the data similar to demoPurchaseData
                
                // For this demo, we'll use the demo data with slight modifications
                currentData = JSON.parse(JSON.stringify(demoPurchaseData));
                
                // Add a simulated company from the "loaded" PDF
                currentData.companies.push({
                    id: 6,
                    name: "GitHub Imports Corp.",
                    purchaseCount: 4,
                    totalSpent: 7600.00
                });
                
                // Add simulated parts
                currentData.parts.push(
                    {
                        id: 13,
                        companyId: 6,
                        partName: "PDF-Specific Valve",
                        invoiceNumber: "INV-GH-001",
                        price: 210.50,
                        date: "2023-05-01",
                        note: "From GitHub PDF"
                    },
                    {
                        id: 14,
                        companyId: 6,
                        partName: "Document Scanner Part",
                        invoiceNumber: "INV-GH-002",
                        price: 125.75,
                        date: "2023-05-10",
                        note: "From GitHub PDF"
                    }
                );
                
                // Update UI
                updateDisplay();
                loadPdfBtn.innerHTML = '<i class="fas fa-file-import"></i> Load PDF';
                loadPdfBtn.disabled = false;
                
                showNotification(`PDF data loaded from GitHub URL. Found ${currentData.companies.length} companies and ${currentData.parts.length} parts.`);
                
                // Auto-select first company
                if (currentData.companies.length > 0) {
                    selectCompany(currentData.companies[0].id);
                }
            }, 1500);
        }
        
        // Perform search for parts
        function performSearch() {
            searchTerm = searchInputEl.value.trim().toLowerCase();
            
            if (!currentData) {
                showNotification("Please load data first", "error");
                return;
            }
            
            if (!searchTerm) {
                showNotification("Please enter a search term", "error");
                return;
            }
            
            // Find parts matching the search
            const matchingParts = currentData.parts.filter(part => 
                part.partName.toLowerCase().includes(searchTerm)
            );
            
            if (matchingParts.length === 0) {
                showNotification(`No parts found matching "${searchTerm}"`, "error");
                return;
            }
            
            // Group by company
            const companyMap = new Map();
            matchingParts.forEach(part => {
                if (!companyMap.has(part.companyId)) {
                    const company = currentData.companies.find(c => c.id === part.companyId);
                    companyMap.set(part.companyId, {
                        company: company,
                        parts: []
                    });
                }
                companyMap.get(part.companyId).parts.push(part);
            });
            
            // Display search results
            displaySearchResults(companyMap, searchTerm);
            showNotification(`Found ${matchingParts.length} parts matching "${searchTerm}"`);
        }
        
        // Display search results
        function displaySearchResults(companyMap, searchTerm) {
            // Clear current selection
            selectedCompanyId = null;
            
            // Update company list to show only companies with matching parts
            companyListEl.innerHTML = '';
            
            let companyCount = 0;
            companyMap.forEach((value, companyId) => {
                const company = value.company;
                const parts = value.parts;
                
                const companyItem = document.createElement('li');
                companyItem.className = 'company-item';
                companyItem.dataset.companyId = companyId;
                companyItem.innerHTML = `
                    <div class="company-name">${company.name}</div>
                    <div style="font-size: 14px; color: #7f8c8d; margin-top: 5px;">
                        ${parts.length} matching part(s)
                    </div>
                `;
                
                companyItem.addEventListener('click', () => {
                    // Highlight the selected company
                    document.querySelectorAll('.company-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    companyItem.classList.add('active');
                    
                    // Show parts for this company (filtered by search)
                    displayPartsForCompany(companyId, searchTerm);
                });
                
                companyListEl.appendChild(companyItem);
                companyCount++;
            });
            
            // Update company count
            companyCountEl.textContent = companyCount;
            
            // Show first company's parts if available
            if (companyMap.size > 0) {
                const firstCompanyId = Array.from(companyMap.keys())[0];
                document.querySelector(`[data-company-id="${firstCompanyId}"]`).classList.add('active');
                displayPartsForCompany(firstCompanyId, searchTerm);
            }
        }
        
        // Select a company to view its parts
        function selectCompany(companyId) {
            selectedCompanyId = companyId;
            
            // Highlight the selected company
            document.querySelectorAll('.company-item').forEach(item => {
                item.classList.remove('active');
                if (parseInt(item.dataset.companyId) === companyId) {
                    item.classList.add('active');
                }
            });
            
            // Display parts for this company
            displayPartsForCompany(companyId);
        }
        
        // Display parts for a specific company
        function displayPartsForCompany(companyId, filterTerm = "") {
            if (!currentData) return;
            
            const company = currentData.companies.find(c => c.id === companyId);
            if (!company) return;
            
            // Update selected company title
            selectedCompanyEl.textContent = `${company.name} - Parts`;
            
            // Get parts for this company
            let companyParts = currentData.parts.filter(part => part.companyId === companyId);
            
            // Apply filter if provided
            if (filterTerm) {
                companyParts = companyParts.filter(part => 
                    part.partName.toLowerCase().includes(filterTerm.toLowerCase())
                );
            }
            
            // Sort by date (newest first)
            companyParts.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Clear table
            partsTableBodyEl.innerHTML = '';
            
            if (companyParts.length === 0) {
                partsTableEl.style.display = 'none';
                noPartsMessageEl.style.display = 'block';
                noPartsMessageEl.innerHTML = filterTerm 
                    ? `<p>No parts found for "${filterTerm}" in ${company.name}.</p>`
                    : `<p>No parts found for ${company.name}.</p>`;
            } else {
                partsTableEl.style.display = 'table';
                noPartsMessageEl.style.display = 'none';
                
                // Group parts by name to check for different prices
                const partPriceMap = new Map();
                companyParts.forEach(part => {
                    if (!partPriceMap.has(part.partName)) {
                        partPriceMap.set(part.partName, []);
                    }
                    partPriceMap.get(part.partName).push(part.price);
                });
                
                // Add rows to table
                companyParts.forEach(part => {
                    const row = document.createElement('tr');
                    
                    // Check if this part has different prices
                    const prices = partPriceMap.get(part.partName);
                    const hasDifferentPrices = prices && prices.length > 1 && new Set(prices).size > 1;
                    
                    // Highlight if it matches search term
                    const isSearchMatch = searchTerm && part.partName.toLowerCase().includes(searchTerm.toLowerCase());
                    
                    row.className = isSearchMatch ? 'highlight' : '';
                    
                    row.innerHTML = `
                        <td>
                            <strong>${part.partName}</strong>
                            ${hasDifferentPrices ? '<br><small style="color:#e74c3c;">(Multiple prices for this part)</small>' : ''}
                        </td>
                        <td>${part.invoiceNumber}</td>
                        <td class="price-cell ${hasDifferentPrices ? 'different-price' : ''}">$${part.price.toFixed(2)}</td>
                        <td>${formatDate(part.date)}</td>
                        <td>${part.note}</td>
                    `;
                    
                    partsTableBodyEl.appendChild(row);
                });
                
                // Update statistics
                updatePartsStatistics(companyParts);
            }
        }
        
        // Update parts statistics
        function updatePartsStatistics(parts) {
            if (!parts || parts.length === 0) {
                totalPartsEl.textContent = '0';
                avgPriceEl.textContent = '$0';
                dateRangeEl.textContent = '-';
                return;
            }
            
            totalPartsEl.textContent = parts.length;
            
            // Calculate average price
            const totalPrice = parts.reduce((sum, part) => sum + part.price, 0);
            const avgPrice = totalPrice / parts.length;
            avgPriceEl.textContent = `$${avgPrice.toFixed(2)}`;
            
            // Calculate date range
            const dates = parts.map(part => new Date(part.date));
            const minDate = new Date(Math.min(...dates));
            const maxDate = new Date(Math.max(...dates));
            
            if (minDate.getFullYear() === maxDate.getFullYear() && 
                minDate.getMonth() === maxDate.getMonth()) {
                dateRangeEl.textContent = formatDate(minDate);
            } else {
                dateRangeEl.textContent = `${formatDate(minDate)} - ${formatDate(maxDate)}`;
            }
        }
        
        // Update the entire display
        function updateDisplay() {
            if (!currentData) {
                // Show empty state
                companyListEl.innerHTML = '<li style="padding: 20px; text-align: center; color: #7f8c8d;">No data loaded. Please load PDF or use demo data.</li>';
                companyCountEl.textContent = '0';
                selectedCompanyEl.textContent = 'Select a Company';
                partsTableEl.style.display = 'none';
                noPartsMessageEl.style.display = 'block';
                totalPurchasesEl.textContent = '0';
                totalSpentEl.textContent = '$0';
                return;
            }
            
            // Update company list
            companyListEl.innerHTML = '';
            currentData.companies.forEach(company => {
                const companyItem = document.createElement('li');
                companyItem.className = 'company-item';
                if (company.id === selectedCompanyId) {
                    companyItem.classList.add('active');
                }
                companyItem.dataset.companyId = company.id;
                companyItem.innerHTML = `
                    <div class="company-name">
                        ${company.name}
                        <span class="purchase-count">${company.purchaseCount}</span>
                    </div>
                    <div style="font-size: 14px; color: #7f8c8d; margin-top: 5px;">
                        Total: $${company.totalSpent.toFixed(2)}
                    </div>
                `;
                
                companyItem.addEventListener('click', () => selectCompany(company.id));
                companyListEl.appendChild(companyItem);
            });
            
            // Update company count
            companyCountEl.textContent = currentData.companies.length;
            
            // Update total purchases and amount
            const totalPurchases = currentData.parts.length;
            const totalSpent = currentData.parts.reduce((sum, part) => sum + part.price, 0);
            totalPurchasesEl.textContent = totalPurchases;
            totalSpentEl.textContent = `$${totalSpent.toFixed(2)}`;
            
            // Show parts for selected company or first company
            if (selectedCompanyId) {
                displayPartsForCompany(selectedCompanyId);
            } else if (currentData.companies.length > 0) {
                selectCompany(currentData.companies[0].id);
            }
        }
        
        // Format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }
        
        // Show notification
        function showNotification(message, type = "success") {
            // Remove existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            // Create new notification
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background-color: ${type === 'error' ? '#e74c3c' : '#2ecc71'};
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                z-index: 1000;
                font-weight: 500;
                animation: fadeIn 0.3s;
            `;
            
            document.body.appendChild(notification);
            
            // Remove notification after 3 seconds
            setTimeout(() => {
                notification.style.animation = 'fadeOut 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
            
            // Add CSS for animations
            if (!document.querySelector('#notification-styles')) {
                const styleEl = document.createElement('style');
                styleEl.id = 'notification-styles';
                styleEl.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(-20px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; transform: translateY(0); }
                        to { opacity: 0; transform: translateY(-20px); }
                    }
                `;
                document.head.appendChild(styleEl);
            }
        }
    </script>
</body>
</html>
