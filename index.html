<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SGX Minerals - Login</title>
    <style>
        /* (All previous CSS unchanged â€“ only map-related rules removed) */
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; }
        body { background:linear-gradient(135deg,#0c0c0c 0%,#1a1a2e 100%); color:#f0f0f0; min-height:100vh; display:flex; justify-content:center; align-items:center; overflow-x:hidden; }
        .container { display:flex; width:900px; height:550px; background:rgba(20,20,30,.8); border-radius:20px; overflow:hidden; box-shadow:0 15px 35px rgba(0,0,0,.5); position:relative; }
        .camera-section { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; background:linear-gradient(45deg,#0f0f1a 0%,#1a1a2e 100%); padding:20px; }
        .camera-container { width:300px; height:300px; border-radius:10px; overflow:hidden; position:relative; box-shadow:0 0 20px rgba(0,0,0,.5); }
        #cameraPreview { width:100%; height:100%; object-fit:cover; background:#2a2a4a; }
        .capture-overlay { position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,.7); display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:opacity .3s ease; }
        .capture-overlay.active { opacity:1; pointer-events:auto; }
        .capture-animation { width:100px; height:100px; border:5px solid #64ff96; border-radius:50%; animation:pulse 1.5s infinite; }
        @keyframes pulse { 0%{transform:scale(.8);opacity:1} 100%{transform:scale(1.5);opacity:0} }
        .login-section { flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:40px; position:relative; }
        .company-title { font-size:32px; font-weight:700; margin-bottom:10px; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); -webkit-background-clip:text; background-clip:text; color:transparent; text-align:center; }
        .company-subtitle { font-size:16px; color:#b0b0d0; margin-bottom:40px; text-align:center; }
        .login-form { width:100%; max-width:320px; padding:30px; background:rgba(30,30,46,.7); border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,.3); transition:box-shadow .5s ease; position:relative; z-index:2; }
        .login-form.glow { box-shadow:0 0 20px rgba(100,255,150,.5); }
        h2 { text-align:center; margin-bottom:30px; font-weight:600; color:#a0f0c0; font-size:28px; }
        .input-group { margin-bottom:20px; position:relative; }
        label { display:block; margin-bottom:8px; font-size:14px; color:#b0b0d0; }
        input { width:100%; padding:12px 15px; background:rgba(40,40,60,.8); border:1px solid #4a4a7a; border-radius:8px; color:#f0f0f0; font-size:16px; transition:all .3s ease; }
        input:focus { outline:none; border-color:#64ff96; box-shadow:0 0 10px rgba(100,255,150,.3); }
        .login-btn { width:100%; padding:12px; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); border:none; border-radius:8px; color:#1a1a2e; font-size:16px; font-weight:600; cursor:pointer; transition:all .3s ease; margin-top:10px; }
        .login-btn:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(100,255,150,.4); }
        .forgot-password { text-align:center; margin-top:20px; }
        .forgot-password a { color:#64ff96; text-decoration:none; font-size:14px; transition:color .3s ease; }
        .forgot-password a:hover { color:#a0f0c0; text-decoration:underline; }
        .decoration { position:absolute; width:200px; height:200px; border-radius:50%; background:radial-gradient(circle,rgba(100,255,150,.1) 0%,rgba(100,255,150,0) 70%); z-index:1; }
        .decoration:nth-child(1){top:-50px;right:-50px;width:150px;height:150px;}
        .decoration:nth-child(2){bottom:-80px;left:-80px;width:200px;height:200px;}
        .camera-info { margin-top:15px; text-align:center; font-size:14px; color:#b0b0d0; }
        .location-status { margin-top:10px; text-align:center; font-size:14px; color:#64ff96; }

        /* Dashboard */
        .dashboard { display:none; width:100%; height:100vh; background:linear-gradient(135deg,#0c0c0c 0%,#1a1a2e 100%); color:#f0f0f0; padding:20px; }
        .dashboard-header { display:flex; justify-content:space-between; align-items:center; padding:20px; background:rgba(20,20,30,.8); border-radius:15px; margin-bottom:30px; box-shadow:0 10px 25px rgba(0,0,0,.3); }
        .welcome-message { font-size:24px; font-weight:600; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); -webkit-background-clip:text; background-clip:text; color:transparent; }
        .dashboard-logout { padding:10px 20px; background:linear-gradient(135deg,#64ff96 0%,#2ecc71 100%); border:none; border-radius:8px; color:#1a1a2e; font-size:16px; font-weight:600; cursor:pointer; transition:all .3s ease; }
        .dashboard-logout:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(100,255,150,.4); }
        .dashboard-content { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:20px; padding:20px; }
        .dashboard-card { background:rgba(20,20,30,.8); border-radius:15px; padding:20px; box-shadow:0 10px 25px rgba(0,0,0,.3); transition:transform .3s ease; }
        .dashboard-card:hover { transform:translateY(-5px); }
        .dashboard-card h3 { font-size:18px; margin-bottom:15px; color:#a0f0c0; }
        .dashboard-card p { color:#b0b0d0; line-height:1.6; }
        .captured-photo-container { margin-top:20px; text-align:center; padding:20px; background:rgba(20,20,30,.8); border-radius:15px; margin-bottom:20px; }
        .captured-photo { max-width:100%; border-radius:8px; margin-top:10px; max-height:300px; }
        .login-record { margin-top:15px; padding:15px; background:rgba(30,30,46,.7); border-radius:10px; text-align:left; }
        .login-record h4 { color:#64ff96; margin-bottom:10px; }
        .login-record p { margin-bottom:5px; color:#b0b0d0; }

        @media (max-width:768px){
            .container{flex-direction:column;width:90%;height:auto;}
            .camera-section{padding:40px 0;}
            .login-section{padding:20px;}
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="container" id="loginPage">
        <div class="camera-section">
            <div class="camera-container">
                <video id="cameraPreview" autoplay></video>
                <div class="capture-overlay" id="captureOverlay">
                    <div class="capture-animation"></div>
                </div>
            </div>
            <div class="camera-info">Camera will capture your photo upon login</div>
            <div class="location-status" id="locationStatus">Getting your location...</div>
        </div>
        <div class="login-section">
            <div class="decoration"></div>
            <div class="decoration"></div>
            <h1 class="company-title">SGX MINERALS</h1>
            <p class="company-subtitle">Resource Management System</p>

            <form class="login-form" id="loginForm">
                <h2>Welcome Back</h2>
                <div class="input-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" placeholder="Enter your username" required>
                </div>
                <div class="input-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="login-btn">Login</button>
                <div class="forgot-password">
                    <a href="#">Forgot Password?</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div class="dashboard" id="dashboardPage">
        <div class="dashboard-header">
            <div class="welcome-message" id="welcomeMessage">Welcome, Employee!</div>
            <button class="dashboard-logout" id="logoutBtn">Logout</button>
        </div>
        <div class="captured-photo-container">
            <h3>Login Security Record</h3>
            <img id="capturedPhoto" class="captured-photo" src="" alt="Captured login photo">
            <div class="login-record" id="loginRecord">
                <h4>Login Details:</h4>
                <div id="loginDetails"></div>
                <p id="locationName" style="margin-top:10px; font-weight:600; color:#64ff96;"></p>
            </div>
        </div>
        <div class="dashboard-content">
            <div class="dashboard-card"><h3>Resource Overview</h3><p>View and manage all mineral resources, inventory levels, and extraction schedules.</p></div>
            <div class="dashboard-card"><h3>Production Analytics</h3><p>Monitor production metrics, efficiency rates, and operational performance.</p></div>
            <div class="dashboard-card"><h3>Employee Management</h3><p>Manage staff schedules, assignments, and performance tracking.</p></div>
            <div class="dashboard-card"><h3>Equipment Status</h3><p>Track equipment maintenance schedules and operational status.</p></div>
            <div class="dashboard-card"><h3>Environmental Compliance</h3><p>Monitor environmental impact and ensure regulatory compliance.</p></div>
            <div class="dashboard-card"><h3>Reports & Documentation</h3><p>Generate reports, export data, and manage documentation.</p></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const loginPage = document.getElementById('loginPage');
            const dashboardPage = document.getElementById('dashboardPage');
            const welcomeMessage = document.getElementById('welcomeMessage');
            const logoutBtn = document.getElementById('logoutBtn');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginForm = document.getElementById('loginForm');
            const cameraPreview = document.getElementById('cameraPreview');
            const captureOverlay = document.getElementById('captureOverlay');
            const capturedPhoto = document.getElementById('capturedPhoto');
            const loginDetails = document.getElementById('loginDetails');
            const locationStatus = document.getElementById('locationStatus');
            const locationNameEl = document.getElementById('locationName');

            // Variables
            let currentStream = null;
            let isCameraActive = false;
            let userLocation = null;

            // Employee DB
            const employees = {
                'sgxminerals': { password: 'admin123', name: 'Alex Johnson', role: 'Operations Manager' },
                'jdoe': { password: 'mineral2023', name: 'Jane Doe', role: 'Geologist' },
                'rsmith': { password: 'extraction22', name: 'Robert Smith', role: 'Field Supervisor' }
            };

            // Pre-fill demo
            usernameInput.value = 'sgxminerals';
            passwordInput.value = 'admin123';

            // ---------- CAMERA ----------
            function startCamera() {
                if (currentStream) stopCamera();
                navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 640 }, height: { ideal: 480 } }, audio: false })
                    .then(stream => { currentStream = stream; cameraPreview.srcObject = stream; isCameraActive = true; })
                    .catch(err => { console.error(err); alert("Camera access denied."); });
            }
            function stopCamera() {
                if (currentStream) { currentStream.getTracks().forEach(t => t.stop()); currentStream = null; isCameraActive = false; }
            }

            // ---------- LOCATION ----------
            function getLocation() {
                locationStatus.textContent = "Getting your location...";
                if (!navigator.geolocation) {
                    setDefaultLocation();
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        userLocation = { lat: pos.coords.latitude, lon: pos.coords.longitude, acc: pos.coords.accuracy };
                        locationStatus.textContent = "Location captured";
                        locationStatus.style.color = "#64ff96";
                        reverseGeocode(userLocation.lat, userLocation.lon);
                    },
                    err => {
                        console.error(err);
                        locationStatus.textContent = "Using default location";
                        locationStatus.style.color = "#ff6464";
                        setDefaultLocation();
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            }

            function setDefaultLocation() {
                userLocation = { lat: 1.280094, lon: 103.850949, acc: 10000 };
                reverseGeocode(userLocation.lat, userLocation.lon);
            }

            // ---------- REVERSE GEOCODE ----------
            async function reverseGeocode(lat, lon) {
                try {
                    const res = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`);
                    const data = await res.json();
                    const address = data.display_name || `${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                    locationNameEl.textContent = `Location: ${address}`;
                } catch (e) {
                    console.error(e);
                    locationNameEl.textContent = `Location: ${lat.toFixed(6)}, ${lon.toFixed(6)} (geocoding failed)`;
                }
            }

            // ---------- CAPTURE ----------
            async function captureImage() {
                if (!isCameraActive) return null;
                captureOverlay.classList.add('active');
                await new Promise(r => setTimeout(r, 1000));

                const canvas = document.createElement('canvas');
                canvas.width = cameraPreview.videoWidth;
                canvas.height = cameraPreview.videoHeight;
                canvas.getContext('2d').drawImage(cameraPreview, 0, 0);
                const dataUrl = canvas.toDataURL('image/jpeg');
                captureOverlay.classList.remove('active');
                return dataUrl;
            }

            // ---------- LOGIN ----------
            async function loginSuccess(name) {
                const photo = await captureImage();
                loginPage.style.display = 'none';
                dashboardPage.style.display = 'block';
                welcomeMessage.textContent = `Welcome, ${name}!`;

                if (photo) capturedPhoto.src = photo;

                const now = new Date();
                const coordText = userLocation ? `${userLocation.lat.toFixed(6)}, ${userLocation.lon.toFixed(6)}` : "N/A";

                loginDetails.innerHTML = `
                    <p><strong>User:</strong> ${name}</p>
                    <p><strong>Login Time:</strong> ${now.toLocaleString()}</p>
                    <p><strong>Coordinates:</strong> ${coordText}</p>
                    <p><strong>Accuracy:</strong> ${userLocation ? userLocation.acc + " m" : "N/A"}</p>
                `;
            }

            // ---------- LOGOUT ----------
            function logout() {
                loginPage.style.display = 'flex';
                dashboardPage.style.display = 'none';
                loginForm.reset();
                usernameInput.value = 'sgxminerals';
                passwordInput.value = 'admin123';
                capturedPhoto.src = '';
                loginDetails.innerHTML = '';
                locationNameEl.textContent = '';
                locationStatus.textContent = "Getting your location...";
                locationStatus.style.color = "#64ff96";
                startCamera();
                getLocation();
            }

            // ---------- EVENTS ----------
            loginForm.addEventListener('submit', async e => {
                e.preventDefault();
                const u = usernameInput.value, p = passwordInput.value;
                if (employees[u] && employees[u].password === p) {
                    await loginSuccess(employees[u].name);
                } else {
                    alert('Invalid credentials.\nHint: sgxminerals / admin123');
                }
            });

            logoutBtn.addEventListener('click', logout);

            // Glow effect
            [usernameInput, passwordInput].forEach(i => {
                i.addEventListener('focus', () => loginForm.classList.add('glow'));
                i.addEventListener('blur', () => { if (!usernameInput.matches(':focus') && !passwordInput.matches(':focus')) loginForm.classList.remove('glow'); });
            });

            // Init
            startCamera();
            getLocation();
        });
    </script>
</body>
</html>
