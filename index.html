<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spare Parts Inventory</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .duplicate-row { background-color: #fff3cd !important; } /* Highlight duplicates */
        h2 { color: #0d6efd; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="container">
    <h2>⚙️ Spare Parts Inventory Manager</h2>
    <hr>

    <div class="row mb-4">
        <div class="col-md-4">
            <label class="form-label">Filter by Company:</label>
            <select id="companyFilter" class="form-select">
                <option value="">All Companies</option>
            </select>
        </div>
        <div class="col-md-8 text-end pt-4">
            <span class="badge bg-warning text-dark">Yellow Rows = Duplicate Names (Check Prices)</span>
        </div>
    </div>

    <table id="partsTable" class="display table table-striped" style="width:100%">
        <thead>
            <tr>
                <th>Spare Part Name</th>
                <th>Company</th>
                <th>Price</th>
                <th>Details/Stock</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            </tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.7.0.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

<script>
    const csvUrl = 'https://raw.githubusercontent.com/bimal-bp/Work_plan/main/spare%20parts%20detials.csv';

    $(document).ready(function() {
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            complete: function(results) {
                let data = results.data;
                let tableBody = $('#tableBody');
                let companyFilter = $('#companyFilter');
                let companies = new Set();
                
                // Track names to find duplicates
                let nameCounts = {};
                data.forEach(row => {
                    if(row['Spare Part Name']) {
                        let name = row['Spare Part Name'].trim();
                        nameCounts[name] = (nameCounts[name] || 0) + 1;
                    }
                });

                data.forEach(row => {
                    if (row['Spare Part Name']) {
                        let isDuplicate = nameCounts[row['Spare Part Name'].trim()] > 1;
                        let rowHtml = `<tr class="${isDuplicate ? 'duplicate-row' : ''}">
                            <td>${row['Spare Part Name']}</td>
                            <td>${row['Company']}</td>
                            <td>${row['Price'] || 'N/A'}</td>
                            <td>${row['Details'] || row['Stock'] || '-'}</td>
                        </tr>`;
                        tableBody.append(rowHtml);
                        if(row['Company']) companies.add(row['Company'].trim());
                    }
                });

                // Fill Company Dropdown
                companies.forEach(c => {
                    companyFilter.append(`<option value="${c}">${c}</option>`);
                });

                // Initialize DataTable
                let table = $('#partsTable').DataTable({
                    pageLength: 25,
                    order: [[0, 'asc']]
                });

                // Company Filter Logic
                $('#companyFilter').on('change', function() {
                    table.column(1).search(this.value).draw();
                });
            }
        });
    });
</script>

</body>
</html>
